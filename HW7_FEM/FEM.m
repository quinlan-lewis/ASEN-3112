clear all; clc; close all;

%Question 1
syms Ew Aw L P phi ux1 uy1 ux2 uy2 

forces = [P*atan(phi)/2; P/2; -P*atan(phi)/2; -P/2];
Lw = L/(cos(phi));
K_const = Ew*Aw/Lw;
K = K_const*[(cos(phi))^2, (sin(phi))*(cos(phi)), -((cos(phi)))^2, -(sin(phi))*(cos(phi));...
    (sin(phi))*(cos(phi)), (sin(phi))^2, -(sin(phi))*(cos(phi)), -((sin(phi))^2);...
    -((cos(phi))^2), -(sin(phi))*(cos(phi)), (cos(phi))^2, (sin(phi))*(cos(phi));...
    -(sin(phi))*(cos(phi)), -((sin(phi))^2), (sin(phi))*(cos(phi)), (sin(phi))^2];
disp = [0; uy1; 0; 0];

Master = forces == K*disp;
clear all;

%Question 2 
E = 3000; P = 200; L = 30;
A1 = 2; A2 = 4; A3 = 3;
L1 = L;
L2 = sqrt((sqrt(3)*L/3)^2 + L^2);
L3 = (L*sqrt(3)/3)/sind(60);
phi1 = deg2rad(0);
phi2 = deg2rad(30);
phi3 = deg2rad(120);

phi = phi1;
K1 = E*A1/L1*[(cos(phi))^2, (sin(phi))*(cos(phi)), -((cos(phi)))^2, -(sin(phi))*(cos(phi));...
    (sin(phi))*(cos(phi)), (sin(phi))^2, -(sin(phi))*(cos(phi)), -((sin(phi))^2);...
    -((cos(phi))^2), -(sin(phi))*(cos(phi)), (cos(phi))^2, (sin(phi))*(cos(phi));...
    -(sin(phi))*(cos(phi)), -((sin(phi))^2), (sin(phi))*(cos(phi)), (sin(phi))^2]
K1_add = [K1(1,1), K1(1,2), 0, 0, 0, 0, K1(1,3), K1(1,4);...
    K1(2,1), K1(2,2), 0, 0, 0, 0, K1(2,3), K1(2,4);...
    0, 0, 0, 0, 0, 0, 0, 0;...
    0, 0, 0, 0, 0, 0, 0, 0;...
    0, 0, 0, 0, 0, 0, 0, 0;...
    0, 0, 0, 0, 0, 0, 0, 0;...
    K1(3,1), K1(3,2), 0, 0, 0, 0, K1(3,3), K1(3,4);...
    K1(4,1), K1(4,2), 0, 0, 0, 0, K1(4,3), K1(4,4)]

phi = phi2;
K2 = E*A2/L2*[(cos(phi))^2, (sin(phi))*(cos(phi)), -((cos(phi)))^2, -(sin(phi))*(cos(phi));...
    (sin(phi))*(cos(phi)), (sin(phi))^2, -(sin(phi))*(cos(phi)), -((sin(phi))^2);...
    -((cos(phi))^2), -(sin(phi))*(cos(phi)), (cos(phi))^2, (sin(phi))*(cos(phi));...
    -(sin(phi))*(cos(phi)), -((sin(phi))^2), (sin(phi))*(cos(phi)), (sin(phi))^2]
K2_add = [0, 0, 0, 0, 0, 0, 0, 0;...
    0, 0, 0, 0, 0, 0, 0, 0;...
    0, 0, K2(1,1), K2(1,2), 0, 0, K2(1,3), K2(1,4);...
    0, 0, K2(2,1), K2(2,2), 0, 0, K2(2,3), K2(2,4);...
    0, 0, 0, 0, 0, 0, 0, 0;...
    0, 0, 0, 0, 0, 0, 0, 0;...
    0, 0, K2(3,1), K2(3,2), 0, 0, K2(3,3), K2(3,4);...
    0, 0, K2(4,1), K2(4,2), 0, 0, K2(4,3), K2(4,4)];

phi = phi3;
K3 = E*A3/L3*[(cos(phi))^2, (sin(phi))*(cos(phi)), -((cos(phi)))^2, -(sin(phi))*(cos(phi));...
    (sin(phi))*(cos(phi)), (sin(phi))^2, -(sin(phi))*(cos(phi)), -((sin(phi))^2);...
    -((cos(phi))^2), -(sin(phi))*(cos(phi)), (cos(phi))^2, (sin(phi))*(cos(phi));...
    -(sin(phi))*(cos(phi)), -((sin(phi))^2), (sin(phi))*(cos(phi)), (sin(phi))^2]
K3_add = [0, 0, 0, 0, 0, 0, 0, 0;...
    0, 0, 0, 0, 0, 0, 0, 0;...
    0, 0, 0, 0, 0, 0, 0, 0;...
    0, 0, 0, 0, 0, 0, 0, 0;...
    0, 0, 0, 0, K3(1,1), K3(1,2), K3(1,3), K3(1,4);...
    0, 0, 0, 0, K3(2,1), K3(2,2), K3(2,3), K3(2,4);...
    0, 0, 0, 0, K3(3,1), K3(3,2), K3(3,3), K3(3,4);...
    0, 0, 0, 0, K3(4,1), K3(4,2), K3(4,3), K3(4,4)];

phi = phi1;
k1 = E*A3/L3*[(cos(phi))^2, (sin(phi))*(cos(phi)); (sin(phi))*(cos(phi)), (sin(phi))^2];

phi = phi2;
k2 = E*A3/L3*[(cos(phi))^2, (sin(phi))*(cos(phi)); (sin(phi))*(cos(phi)), (sin(phi))^2];

Ktot = K1_add + K2_add + K3_add;

f4 = [0; -200];
K_reduced = [Ktot(7,7), Ktot(7,8); Ktot(8,7), Ktot(8,8)];
u4 = K_reduced\f4;

utot = [0; 0; 0; 0; 0; 0; u4(1); u4(2)];
ftot = Ktot*utot;

f1_local = trans(0)*[ftot(1); ftot(2); ftot(7); ftot(8)]
f2_local = trans(deg2rad(30))*[ftot(3); ftot(4); ftot(7); ftot(8)]
f3_local = trans(deg2rad(120))*[ftot(5); ftot(6); ftot(7); ftot(8)]
